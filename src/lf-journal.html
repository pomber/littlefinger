<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/paper-item/paper-icon-item.html">
<link rel="import" href="../bower_components/paper-item/paper-item-body.html">
<link rel="import" href="../bower_components/paper-material/paper-material.html">
<link rel="import" href="lf-icon.html">
<link rel="import" href="lf-money.html">
<link rel="import" href="lf-record.html">
<link rel="import" href="lf-record-repository.html">
<link rel="import" href="lf-transfer.html">
<link rel="import" href="material-table-styles.html">
<link rel="import" href="sub-header-styles.html">

<dom-module id="lf-journal">

    <template>        

        <style include="material-table-styles iron-flex iron-flex-alignment sub-header-styles"></style>
        <style>
            :host {
                display: block;
            }

            paper-material {
                @apply(--layout-self-start);
                margin: 0px 5px;
                min-width: 100px;
                max-width: 768px;
            }

            .main {
                padding: 16px;
            }
        </style>

        <lf-record-repository app="[[app]]" list="{{records}}">
        </lf-record-repository>

        <nav class="horizontal layout justified">
            <paper-tabs noink selected="0" scrollable class="flex">
                <paper-tab>All</paper-tab>
                <paper-tab>Bank Account</paper-tab>
                <paper-tab>Credit Card</paper-tab>
                <paper-tab>Cash</paper-tab>
            </paper-tabs>
        </nav>

        <div class="main horizontal layout center-justified">            
            <paper-material elevation="1" class="flex">
                <div class="horizontal layout justified">
                    <h3 class="flex"></h3>
                    <paper-button on-tap="newRecord">New Record</paper-button>
                    <paper-button on-tap="newTransfer">New Transfer</paper-button>
                </div>

                <paper-listbox>                  
                    <template is="dom-repeat" items="[[records]]">
                        <paper-icon-item on-tap="editRecord">
                            <lf-icon 
                                icon="[[_getCategoryIcon(item)]]"
                                label="[[item.category]]"
                                color= "[[_getCategoryColor(item)]]" 
                                item-icon></lf-icon>
                            <paper-item-body two-line>
                                <div class="horizontal layout justified">
                                    <span>{{item.category}}</span>
                                    <lf-money amount="{{item.amount}}"></lf-money>
                                </div>
                                <div secondary>
                                    <span>{{item.date}}</span>
                                </div>
                            </paper-item-body>
                        </paper-icon-item>
                    </template>
                </paper-listbox>
            </paper-material>
        </div>

        <lf-record id="recordForm" app="[[app]]"></lf-record>
        <lf-transfer id="transferForm" app="[[app]]"></lf-transfer>
        
    </template>

    <script>
        Polymer({
            is: 'lf-journal',

            properties: {
                app: Object
            },

            newTransfer: function() {
                this.$.transferForm.show();
            },

            newRecord: function() {
                this.$.recordForm.show();
            },

            editRecord: function(e) {                
                var item = e.model.item;
                if (item.type == "transfer") {
                    this.$.transferForm.show(item.$key);
                } else {
                    this.$.recordForm.show(item.$key);
                }        
            },

            _getCategoryIcon: function(record) {
                var cat = this.app.getCategory(record.category); 
                return cat && cat.icon;
            },

            _getCategoryColor: function(record) {
                var cat = this.app.getCategory(record.category);
                return cat && cat.color;
            },
        });
    </script>

</dom-module>
<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-material/paper-material.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/paper-item/paper-icon-item.html">
<link rel="import" href="../bower_components/paper-item/paper-item-body.html">
<link rel="import" href="../bower_components/polymer-sortablejs/polymer-sortablejs.html">
<link rel="import" href="lf-category.html">
<link rel="import" href="lf-icon.html">
<link rel="import" href="material-table-styles.html">

<dom-module id="lf-categories">

    <template>        

        <style include="material-table-styles iron-flex iron-flex-alignment"></style>
        <style>
            :host {
                display: block;
                padding: 16px;
            }

            paper-material {
                @apply(--layout-self-start);
                margin: 0px 5px;
            }
            
            .sortable-ghost {
                opacity: 0.3;
            }
        </style>

        <div class="horizontal layout center-justified">
            <paper-material elevation="1" style="max-width: 768px" class="flex">
                <div class="horizontal layout justified">
                    <h3></h3>
                    <paper-button on-tap="create">New {{detailName}}</paper-button>
                </div>

                <lf-category id="detailForm" user="[[user]]"></lf-category>


                <paper-listbox>               
                    <sortable-js>     
                    <template is="dom-repeat" items="{{_toArray(user.categories)}}">
                        <paper-icon-item on-tap="edit">
                            <lf-icon 
                                icon="[[item.icon]]"
                                label="[[item.name]]"
                                color= "[[item.color]]" 
                                item-icon></lf-icon>
                            <paper-item-body two-line>
                                <div class="horizontal layout justified">
                                    <span>{{item.name}}</span>
                                    <!--<span>{{item.frequency}}</span>-->
                                </div>
                                <div secondary>
                                    <span>{{item.frequency}}</span>
                                </div>
                            </paper-item-body>
                        </paper-icon-item>
                    </template>
                    </sortable-js>
                </paper-listbox>
            </paper-material>
            <!--<paper-material elevation="1" style="max-width: 768px" class="flex">
            </paper-material>-->
        </div>
        
    </template>

    <script>
        Polymer({
            is: 'lf-categories',
            properties: {
                user: Object,
                masterName: {
                    type: String,
                    value: "Categories",
                },
                detailName: {
                    type: String,
                    value: "Category",
                },           
                order: {
                    type: String,
                    value: "order"
                }
            },

            create: function() {
                this.$.detailForm.show();
            },

            edit: function(e) {                
                var item = e.model.item;                
                this.$.detailForm.show(item.id);
            },
            
            _toArray: function(details) {
                if (!details) return details;
                return Object.keys(details).map(function(key) {
                    details[key].id = key;
                    return details[key];
                });
            },
        });
    </script>

</dom-module>
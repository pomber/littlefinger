<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/polymerfire/firebase-document.html">
<link rel="import" href="lodash.html">

<dom-module id="lf-category-repository">

    <template>
        <firebase-document id="document" log>
        </firebase-document>
    </template>

    <script>
        Polymer({
            is: 'lf-category-repository',

            properties: {
                app: {
                    type: Object
                },
                categories: {
                    type: Array,
                    computed: "_sortCategories(app.categories.splices)",
                    notify: true,
                }
            },

            save: function(data) {
                var storage = this.$.document;
                var path = 
                    "/users/" + this.app.user.uid + 
                    "/categories//" + data.$key;
                var clone = _.cloneDeep(data);
                delete clone.$key;
                storage.setStoredValue(path, clone);
            },

            get: function(key) {
                var item = _.find(this.app.categories, ["$key", key]);
                if (item) return _.cloneDeep(item);
                return {
                    icon: null,
                    color: null,
                    type: "expense",
                    parent: null
                };
            },

            _sortCategories: function() {
                return _.orderBy(this.app.categories, "order");
            }
        });
    </script>

</dom-module>